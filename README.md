# ИДЗ 3
Кадыкова Татьяна Алексеевна, БПИ213

Вариант 34

Тесты, на которых проверялась работа программ, находятся в папке `test`.
Файлы с названиями `input*.txt` являются входными файлами.
Выходные файлы с названиями `output*.txt` находятся в папках соответствующих программ.
Обязательным для запуска является указание файла `decoder.txt`, в данном проекте он находится
в корне, он использовался для всех входных файлов.

## Задание
И снова пляшущие человечки. Узнав о планах преступников по
шифрованию текстов, Шерлок Холмс предложил лондонской полиции специальную машину для дешифровки сообщений злоумышленников. Реализовать приложение, дешифрующее кодированный текст. В качестве ключа используется известная кодовая таблица, устанавливающая однозначное соответствие между каждой буквой и каким-нибудь числом. Процессом узнавания кода в решении задачи пренебречь. Каждый процесс–дешифровщик декодирует свои кусочки текста, многократно получаемые от менеджера. Распределение фрагментов
текста между процессами–дешифровщиками осуществляется процессом–
менеджером, который передает каждому процессу фрагмент зашифрованного текста,
получает от него результат, передает следующий зашифрованный фрагмент.
Он же собирает из отдельных
фрагментов зашифрованный текст. Количество процессов задается опционально.
Каждый процесс может выполнять свою работу за случайное время.
Сервер — процесс–менеджер. Клиенты — процессы–дешифровщики.


## Компиляция и запуск на оценку 4-5
Компиляция через: 

`gcc server.c -o server -lpthread -lrt`

`gcc client.c -o client`

Запуск программы происходит в разных терминалах через: 

1. `./server <Clients number> <Input file> <Output file> <Server Port>`.
2. `./client <Decoder file> <Server IP> <Echo Port>`.

Многие общие серверные глобальные переменные были вынесены в файл `info.h`, а клиентские в `clientinfo.h`, 
для более удобного пользования, а также некоторые функции.

## Компиляция и запуск на оценку 6-7
Компиляция через:

`gcc server.c -o server -lpthread -lrt`

`gcc client_decoder.c -o client`

`gcc client_observer.c -o observer`

Запуск программы происходит в разных терминалах через:

1. `./server <Clients number> <Input file> <Output file> <Server Port>`.
2. `./client <Decoder file> <Server IP> <Echo Port>`.
3. `./observer <Server IP> <Echo Port>`.

Многие общие серверные глобальные переменные были вынесены в файл `info.h`, а клиентские в `clientinfo.h`,
для более удобного пользования, а также некоторые функции.

## На 4-5
Код находится в `for45/server.c` и `for45/client.c`.
Использовалась разделяемая память по названию "shared-memory" и
неименованных семафоров, расположенных в ней.

Сервер создает процессы для работы с каждым клиентом и 
передает информацию процессам аналогично критериям ИДЗ2 на оценку 5, 
как и сама работа главного процесса менеджера с входными и выходными данными.
Процессы принимают запрос на подключение от клиента, сообщают главному процессу менеджеру о готовности
начать работу через семафоры. Менеджер ждет готовности всех процессов (соответственно, подключения всех клиентов)
и после начинается работа. Процессы, обрабатывающие клиентов-дешифровщиков, отправляют из 
разделяемой памяти закодированное сообщение и получают в ответ декодированное сообщение, 
которое обратно записывается в разделяемую память. По окончании работы процессы закрывают сокет клиента.

Клиенты же после подключения к серверу работают до тех пор, пока им приходят сообщения, 
как только соединение разрывается, клиенты завершают свою работу. 
В самом начале работы клиент считывает из файла таблицу декодирования. 
Полученное сообщение клиент декодирует и отправляет обратно декодированное сообщение.

## На 6-7
Код находится в `for67/server.c`, `for67/client_decoder.c` и `for67/client_observer.c`.
Взаимодействие сервера и клиентов-дешифровщиков не изменилось.
Клиент-наблюдатель подключается к серверу, печатает все сообщения, которые ему приходят, 
и прекращает работу, когда соединение разрывается.
Сервер создает еще один процесс для работы с клиентом-наблюдателем.
Разделяемая память увеличивается в размере, место для передачи сообщения процессу, работающему с наблюдателем.
Этот процесс по семафорам определяет, что нужно отправить новое сообщение из разделяемой памяти, и делает это.
Сервер перед отправкой нового сообщения ждет сигнала на семафор в разделяемой памяти о том, что сообщение отправлено.
